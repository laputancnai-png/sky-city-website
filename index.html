<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>天空之城</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600&family=Zen+Kurenaido&family=Yuji+Syuku&display=swap" rel="stylesheet">
  <style>
    :root {
      --paper:      #f0ebe2;
      --ink:        #2c2420;
      --ink-light:  #6b5f52;
      --ink-fade:   #9a8e7f;
      --water-blue: #6a8fa8;
      --water-teal: #4a7c6f;
      --font-hand: 'Zen Kurenaido', 'Yuji Syuku', 'Noto Serif JP', serif;
    }

    * { box-sizing: border-box; margin:0; padding:0 }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--font-hand);
      background: var(--paper);
      color: var(--ink);
      -webkit-font-smoothing:antialiased;
      min-height:100vh;
      line-height:1.45;
    }

    /* Page frame */
    .wrap { max-width: 980px; margin: 0 auto; padding: 28px 20px 120px; }

    header { display:flex; align-items:center; justify-content:space-between; gap:20px; margin-bottom:18px }
    .brand { display:flex; align-items:center; gap:14px }
    .brand img { width:52px; height:52px; object-fit:cover; border-radius:8px; box-shadow:2px 2px 0 rgba(44,36,32,0.06) }
    .brand h1 { font-size:1.05rem; letter-spacing:0.2em; font-weight:400; margin:0 }
    .brand a { text-decoration: none; color: inherit }
    .brand a:visited { color: inherit }
    .brand a h1 { margin:0 }

    nav a { color:var(--ink-light); text-decoration:none; margin-left:14px; font-size:0.9rem }
    nav a:hover { color:var(--ink); }
    .timeline-btn { background:none; border:none; font-family:var(--font-hand); color:var(--water-teal); cursor:pointer; padding:6px 10px; border-radius:8px; font-size:0.95rem }
    .timeline-btn:hover { opacity:0.85 }

    /* Hero */
    .hero { display:flex; gap:28px; align-items:center; margin: 18px 0 32px }
    .hero-left { flex:1 }
    .sketch-island { width:480px; max-width:44vw; height:260px; border-radius:12px; overflow:hidden; background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(240,235,226,0.8)); display:flex; align-items:center; justify-content:center; box-shadow:0 18px 40px rgba(106,143,168,0.12); transition:transform .35s }
    .sketch-island img { width:100%; height:100%; object-fit:cover }
    .sketch-island:hover { transform:translateY(-8px) }

    .hero-right { flex:1; max-width:420px }
    .hero-title { font-size:clamp(2rem,5.5vw,3.4rem); letter-spacing:0.18em; margin-bottom:12px }
    .hero-sub { color:var(--ink-fade); letter-spacing:0.25em; margin-bottom:18px }
    .enter-btn { display:inline-block; padding:10px 16px; border-radius:8px; background:var(--water-blue); color:#fff; text-decoration:none; font-weight:600 }

    /* Articles list */
    .section { margin-top:28px }
    .section h2 { font-size:1.2rem; margin-bottom:12px; letter-spacing:0.12em }
    .posts { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px }
    .post { background:rgba(255,255,255,0.6); padding:12px 14px; border-radius:10px; box-shadow: 0 6px 18px rgba(44,36,32,0.04); border:1px solid rgba(44,36,32,0.03) }
    .post a { color:var(--ink); text-decoration:none; font-weight:600 }
    .post p { color:var(--ink-light); font-size:0.85rem; margin-top:8px }

    /* About */
    .about { margin-top:28px; padding:16px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.55), transparent); border:1px solid rgba(44,36,32,0.03) }
    .about h2 { text-align:center; margin-bottom:10px }
    .about p { color:var(--ink-light); text-align:center }

    footer { margin-top:44px; text-align:center; color:var(--ink-fade); font-size:0.82rem }

    @media (max-width:780px) {
      .hero { flex-direction:column }
      .sketch-island { max-width:85vw }
      .wrap { padding-bottom:80px }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="site-header">
      <div class="brand">
        <a href="/" title="首页"><img src="skycity_cutout.png" alt="logo" /></a>
        <a href="/" title="首页"><h1>天空之城</h1></a>
      </div>
      <nav>
        <button class="timeline-btn" onclick="(typeof resetFilter==='function')?resetFilter():location.href='index_sidebar_template.html'">↺ 时光索引</button>
        {{AUTH_LINKS}}
      </nav>
    </header>

    <section class="hero">
      <div class="hero-left">
        <div class="sketch-island" onclick="enterWorld()" title="点击进入">
          <img src="skycity_cutout.png" alt="天空之城" />
        </div>
      </div>
      <div class="hero-right">
        <div class="hero-title">天 空 之 城</div>
        <div class="hero-sub">记录生活中的每一片云彩</div>
        <a class="enter-btn" href="home.html">进入城中 →</a>
      </div>
    </section>

    <section class="section">
      <h2>最新发布</h2>
      <div class="posts" id="posts">
        <div class="post">正在加载最新文章…</div>
      </div>
    </section>

    <section class="about">
      <h2>关于这座城</h2>
      <p>这里是我的天空之城——一个漂浮在云层之间的小小角落。<br><br>
      就像宫崎骏笔下那座被遗忘在高空中的古老城市，<br>
      我想在这里记录下生活中那些微小却珍贵的瞬间。<br><br>
      每一篇日记，都是这座城里盛开的一朵花。<br>
      愿你也能在这里，找到一刻静静的<em>安宁</em>。</p>
    </section>

    <footer>
      天空之城 · 用温柔记录生活 · ♡ 2025
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', loadLatestPosts);

    async function loadLatestPosts(){
      const container = document.getElementById('posts');
      container.innerHTML = '<div class="post">正在加载最新文章…</div>';
      try{
        const homeRes = await fetch('./home.html');
        if(homeRes.ok){
          const homeHtml = await homeRes.text();
          const hdoc = new DOMParser().parseFromString(homeHtml, 'text/html');
          const cards = Array.from(hdoc.querySelectorAll('.diary-card'));
          if(cards.length>0){
            const latest = cards.slice(0,3);
            container.innerHTML = '';
            for(const c of latest){
              let href = '';
              const onclick = c.getAttribute('onclick') || '';
              const m = onclick.match(/window.location.href='([^']+)'/);
              if(m) href = './' + m[1];
              const titleEl = c.querySelector('.card-title');
              const textEl = c.querySelector('.card-text');
              const dateEl = c.querySelector('.card-date');
              const title = titleEl ? titleEl.textContent.trim() : href.replace(/^\.\//,'');
              const excerpt = textEl ? textEl.textContent.trim().replace(/\s+/g,' ').slice(0,180) : '';
              const date = dateEl ? dateEl.textContent.trim().replace(/\./g,'-') : '';
              const node = document.createElement('div');
              node.className = 'post';
              node.innerHTML = `<a href="${href}">${title} ${date ? '— ' + date : ''}</a>${excerpt ? `<p>${excerpt}</p>` : ''}`;
              container.appendChild(node);
            }
            return;
          }
        }

        const res = await fetch('./articles/');
        if(!res.ok) throw new Error('目录请求失败');
        const text = await res.text();
        const doc = new DOMParser().parseFromString(text, 'text/html');
        const anchors = Array.from(doc.querySelectorAll('a'));
        const files = anchors.map(a=>a.getAttribute('href')).filter(h=>h && h.endsWith('.html'));
        const articles = files.map(h=>{
          const m = h.match(/article_(\d{8})_/);
          const dateStr = m ? m[1] : null;
          const date = dateStr ? new Date(dateStr.slice(0,4)+'-'+dateStr.slice(4,6)+'-'+dateStr.slice(6,8)) : new Date(0);
          return { href: './articles/' + h, name: h, date };
        }).sort((a,b)=>b.date - a.date).slice(0,3);

        if(articles.length === 0){ container.innerHTML = '<div class="post">没有找到文章。</div>'; return; }

        container.innerHTML = '';
        for(const art of articles){
          let excerpt = '';
          try{
            const r = await fetch(art.href);
            if(r.ok){
              const html = await r.text();
              const adoc = new DOMParser().parseFromString(html, 'text/html');
              const p = adoc.querySelector('p');
              excerpt = p ? p.textContent.trim().replace(/\s+/g,' ').slice(0,140) : '';
            }
          }catch(e){ }

          const displayDate = (!isNaN(art.date)) ? art.date.toISOString().slice(0,10) : '';
          const title = (function(n){ return n.replace(/\.html$/, '').replace(/^article_\d{8}_?/, '').replace(/_/g,' '); })(art.name);

          const node = document.createElement('div');
          node.className = 'post';
          node.innerHTML = `<a href="${art.href}">${title} ${displayDate ? '— ' + displayDate : ''}</a>${excerpt ? `<p>${excerpt}</p>` : ''}`;
          container.appendChild(node);
        }

      }catch(err){
        console.error(err);
        container.innerHTML = '<div class="post">加载失败。</div>';
      }
    }

    function enterWorld(){
      document.body.style.transition = 'opacity .6s';
      document.body.style.opacity = '0';
      setTimeout(()=> location.href='home.html', 550);
    }
  </script>
</body>
</html>
