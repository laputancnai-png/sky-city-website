<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>天空之城</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600&family=Zen+Kurenaido&family=Yuji+Syuku&display=swap" rel="stylesheet">
<style>
/* ────────────────────────────────────────
   设计核心理念：宫崎骏《天空之城》手稿风格
   ──────────────────────────────────────── */

:root {
  --paper:      #f0ebe2;
  --ink:        #2c2420;
  --ink-light:  #6b5f52;
  --ink-fade:   #9a8e7f;
  --water-blue: #6a8fa8;
  --water-teal: #4a7c6f;
  --warm-rust:  #b06840;
  --warm-gold:  #c89a50;
  --font-hand: 'Zen Kurenaido', 'Yuji Syuku', 'Noto Serif JP', serif;
}

/* container to align header with site */
.wrap { max-width: 980px; margin: 0 auto; padding: 28px 20px 0; position: relative; z-index: 12; }

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }

body {
  font-family: var(--font-hand);
  background: var(--paper);
  color: var(--ink);
  overflow-x: hidden;
  position: relative;
}

/* 纸张纹理背景 */
body::before {
  content: ''; position: fixed; inset: 0; z-index: 0; background: var(--paper);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='400' height='400' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
}

/* 水彩天空层 */
.watercolor-sky {
  position: absolute; top: 0; left: 0; right: 0; height: 100vh; z-index: 1; overflow: hidden; pointer-events: none;
}
.wc-layer { position: absolute; inset:0; opacity: 0.55; filter: blur(42px); }
.wc-layer--1 {
  background: radial-gradient(ellipse 90% 60% at 30% 20%, rgba(106,143,168,0.5) 0%, transparent 65%),
              radial-gradient(ellipse 70% 50% at 75% 35%, rgba(138,184,204,0.35) 0%, transparent 60%);
}
.wc-layer--2 {
  background: radial-gradient(ellipse 50% 45% at 20% 55%, rgba(106,143,168,0.25) 0%, transparent 70%),
              radial-gradient(ellipse 80% 50% at 50% 15%, rgba(138,184,204,0.2) 0%, transparent 65%);
  opacity: 0.4;
}

main { position: relative; z-index: 2; }

/* Hero Section */
.hero {
  position: relative; min-height: 85vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px 40px;
}
.sketch-island {
  position: relative; width: 480px; max-width: 85vw; height: 280px; margin-bottom: 20px;
  animation: gentle-drift 8s ease-in-out infinite; display: flex; align-items: center; justify-content: center;
}
.sketch-island-img {
  max-width: 100%; max-height: 100%; object-fit: contain; filter: sepia(0.06) saturate(0.98) brightness(0.99) contrast(1.01);
}
@keyframes gentle-drift { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
.sketch-cloud {
  position: absolute; border-radius: 50%; filter: blur(var(--blur, 18px)); opacity: var(--op, 0.35); pointer-events: none; animation: cloud-drift var(--dur, 30s) linear infinite;
}
@keyframes cloud-drift { 0% { transform: translateX(0); } 100% { transform: translateX(var(--dx, 120px)); } }
.cloud--a { top:15%; left:-5%; width:240px; height:80px; background:rgba(200,215,225,0.6); --blur:24px; --op:0.4; --dur:38s; --dx:180px; }
.hero-title {
  font-family: var(--font-hand); font-size: clamp(2.5rem, 7vw, 4rem); color: var(--ink);
  text-shadow: 1px 1px 0 rgba(44,36,32,0.15); animation: title-appear 1.8s cubic-bezier(.22,1,.36,1) both;
}
@keyframes title-appear { 0% { opacity:0; transform: translateY(20px); } 100% { opacity:1; transform: translateY(0); } }
.hero-sub { margin-top: 10px; font-size: 0.9rem; color: var(--ink-fade); letter-spacing: 0.3em; animation: fade-up 2s 0.5s both; }
@keyframes fade-up { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
.scroll-hint { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); color: var(--ink-fade); font-size: 0.7rem; letter-spacing: 0.2em; display:flex; flex-direction:column; align-items:center; animation: fade-up 1.5s 1.5s both; }
.scroll-hint .arrow-down { width:12px; height:12px; border-right:1.5px solid var(--ink-fade); border-bottom:1.5px solid var(--ink-fade); transform:rotate(45deg); animation: bob 2s infinite; }
@keyframes bob { 0%,100%{transform:rotate(45deg) translateY(0);opacity:0.5;} 50%{transform:rotate(45deg) translateY(5px);opacity:1;} }

/* 分割线 */
.ink-divider { width: 100%; max-width: 600px; margin: 0 auto; display: block; opacity: 0.22; }

/* ═══ 布局容器 ═══ */
.content-wrapper {
  max-width: 1100px;
  margin: 60px auto 100px;
  padding: 0 20px;
  display: flex;
  gap: 60px; /* Increased gap */
  position: relative;
}

/* ── 侧边栏 (时间轴) ── */
.sidebar {
  width: 180px;
  flex-shrink: 0;
  position: relative;
}
.sidebar-sticky {
  position: sticky;
  top: 40px;
  max-height: 85vh;
  overflow-y: auto;
  /* 隐藏默认滚动条 */
  scrollbar-width: none; 
  -ms-overflow-style: none;
}
.sidebar-sticky::-webkit-scrollbar { display: none; }

/* 时间轴标题 */
.timeline-header {
  margin-bottom: 25px;
  padding-left: 10px;
}
.timeline-btn {
  background: none; border: none; font-family: var(--font-hand);
  font-size: 1.1rem; color: var(--warm-rust); cursor: pointer;
  padding: 0; font-weight: 600;
  display: flex; align-items: center; gap: 6px;
  transition: opacity 0.3s;
}
.timeline-btn:hover { opacity: 0.8; }
.timeline-btn span { font-size: 1.2rem; }

/* Ensure header stays on top and items are spaced */
.site-header { position: relative; z-index: 20; display:flex; align-items:center; justify-content:space-between; gap:12px; padding:8px 0; }
.site-header .brand { display:flex; align-items:center; gap:12px; }
.site-header nav { display:flex; align-items:center; gap:12px; margin-left:auto; }

/* ── 手绘风时间轴 ── */
.timeline-list {
  list-style: none;
  padding-left: 0;
  position: relative;
  margin-left: 12px; /* 给线留空间 */
}
/* 贯穿竖线 - 铅笔线条感 */
.timeline-list::before {
  content: '';
  position: absolute;
  top: 8px; bottom: 0; left: 5px; /* 线条位置 */
  width: 1.5px;
  background: rgba(44,36,32,0.18);
  border-radius: 1px;
}

/* 年份节点 */
.year-item {
  position: relative;
  margin-bottom: 24px;
}

.year-label {
  display: block;
  padding-left: 28px;
  font-size: 1.15rem;
  color: var(--ink);
  cursor: pointer;
  font-weight: 600;
  transition: color 0.3s;
  line-height: 1.2;
}
.year-label:hover { color: var(--warm-rust); }

/* 年份圆点 (石头/节点) */
.year-label::before {
  content: '';
  position: absolute;
  left: 0; top: 3px; /* 居中于文字 */
  width: 11px; height: 11px;
  background: var(--paper);
  border: 2px solid var(--ink-fade);
  border-radius: 50% 45% 55% 50%; /* 不规则圆 */
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  z-index: 2;
  box-shadow: 0 0 0 4px var(--paper); /* 遮挡线条 */
}

/* 选中年份状态 */
.year-item.active .year-label { color: var(--warm-rust); }
.year-item.active .year-label::before {
  background: var(--warm-rust);
  border-color: var(--warm-rust);
  transform: scale(1.3);
}

/* 月份列表 (树枝分支) */
.month-list {
  list-style: none;
  margin-top: 12px;
  margin-left: 5px; /* 对齐竖线 */
  padding-left: 0;
  display: none;
}
.year-item.active .month-list {
  display: block;
  animation: branch-grow 0.5s ease forwards;
}
@keyframes branch-grow { from {opacity:0; transform:translateY(-5px);} to {opacity:1; transform:translateY(0);} }

/* 月份节点 */
.month-item {
  position: relative;
  padding-left: 30px;
  font-size: 0.9rem;
  color: var(--ink-fade);
  margin-bottom: 12px;
  cursor: pointer;
  transition: color 0.2s;
  font-weight: 300;
}
.month-item:hover { color: var(--water-teal); }

/* 月份连接线 (小横枝) */
.month-item::before {
  content: '';
  position: absolute;
  left: 0; top: 50%;
  width: 18px; height: 1px;
  background: rgba(44,36,32,0.15);
}
/* 月份小点 */
.month-item::after {
  content: '';
  position: absolute;
  left: 18px; top: 50%;
  transform: translateY(-50%);
  width: 5px; height: 5px;
  background: var(--ink-fade);
  border-radius: 50%;
  transition: all 0.2s;
}

/* 选中月份状态 */
.month-item.active { color: var(--water-teal); font-weight: 600; }
.month-item.active::after {
  background: var(--water-teal);
  transform: translateY(-50%) scale(1.5);
}

/* ── 右侧卡片区 ── */
.diary-section { flex-grow: 1; }
.diary-header { text-align: left; margin-bottom: 40px; padding-left: 10px; border-left: 3px solid var(--water-blue); }
.diary-header h2 { font-size: 1.4rem; color: var(--ink); letter-spacing: 0.1em; margin-left: 15px; }

.diary-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }

/* 卡片样式 */
.diary-card {
  background: linear-gradient(145deg, rgba(244,239,230,0.95), rgba(235,228,215,0.97));
  border: 1px solid rgba(44,36,32,0.12);
  border-radius: 4px; padding: 26px; position: relative;
  transition: transform 0.4s, box-shadow 0.4s; cursor: pointer;
}
.diary-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(44,36,32,0.12); }
.diary-card::before { content:''; position:absolute; top:0; bottom:0; left:32px; width:1px; background: rgba(176,104,64,0.2); }
.card-tag { position:absolute; top:12px; left:38px; font-size: 0.6rem; color: var(--water-teal); border: 1px solid rgba(74,124,111,0.3); padding: 1px 6px; border-radius: 2px; }
.card-date { margin-top: 18px; font-size: 0.75rem; color: var(--ink-fade); font-family: 'Noto Serif JP', serif; }
.card-title { font-size: 1.15rem; color: var(--ink); font-weight: 600; margin: 8px 0 10px; line-height: 1.4; }
.card-text { font-size: 0.88rem; color: var(--ink-light); line-height: 1.7; font-weight:300; }
.card-watercolor { position:absolute; bottom:0; left:0; right:0; height:5px; opacity:0.3; filter: blur(2px); border-radius: 0 0 4px 4px; }
.card--blue .card-watercolor { background: var(--water-blue); }
.card--teal .card-watercolor { background: var(--water-teal); }
.card--rust .card-watercolor { background: var(--warm-rust); }
.card--moss .card-watercolor { background: var(--moss); }
.card--gold .card-watercolor { background: var(--warm-gold); }
.card--sky  .card-watercolor { background: var(--water-sky); }

.diary-card.hidden { display: none; }
.reveal { opacity:0; transform: translateY(20px); transition: 0.8s; }
.reveal.visible { opacity:1; transform: translateY(0); }

/* Footer */
footer { text-align: center; padding: 60px 20px; color: var(--ink-fade); font-size: 0.75rem; letter-spacing: 0.2em; opacity: 0.8; }

/* ── 用户状态栏 (右上角) ── */
.auth-bar {
  position: absolute;
  top: 20px;
  right: 30px;
  z-index: 10;
  font-size: 0.85rem;
  letter-spacing: 0.1em;
}
.auth-link {
  text-decoration: none;
  color: var(--ink-fade);
  margin-left: 15px;
  transition: color 0.3s;
  padding-bottom: 2px;
  border-bottom: 1px dashed transparent;
}
.auth-link:hover {
  color: var(--warm-rust);
  border-bottom-color: var(--warm-rust);
}
.auth-user {
  color: var(--ink);
  font-weight: 600;
  margin-right: 10px;
}

@media (max-width: 800px) {
  .content-wrapper { flex-direction: column; gap: 30px; }
  .sidebar { width: 100%; padding-bottom: 20px; border-bottom: 1px dashed rgba(44,36,32,0.2); }
  .sidebar-sticky { position: static; max-height: none; display: flex; flex-direction: column; }
  .timeline-list { display: flex; overflow-x: auto; gap: 20px; margin-left: 0; padding-bottom: 10px; }
  .timeline-list::before { display: none; } /* Remove vertical line on mobile */
  .year-item { margin-bottom: 0; flex-shrink: 0; }
  .year-label::before { display: none; } /* Remove dots on mobile */
  .year-label { padding-left: 0; border: 1px solid rgba(44,36,32,0.2); padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; }
  .year-item.active .year-label { background: var(--warm-rust); color: #fff; border-color: var(--warm-rust); }
  .month-list { position: absolute; left: 0; right: 0; background: var(--paper); padding: 10px; z-index: 10; border: 1px solid rgba(44,36,32,0.1); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .month-item { display: inline-block; margin-right: 15px; padding-left: 0; }
  .month-item::before, .month-item::after { display: none; }
}

</style>
</head>
<body>

<div class="watercolor-sky"><div class="wc-layer wc-layer--1"></div><div class="wc-layer wc-layer--2"></div></div>

  <div class="wrap">
    <header class="site-header">
      <div class="brand">
        <a href="/" title="首页"><img src="skycity_cutout.png" alt="logo" /></a>
        <a href="/" title="首页"><h1>天空之城</h1></a>
      </div>
      <nav>
        {{AUTH_LINKS}}
      </nav>
    </header>
  </div>

<main>

  <svg class="ink-divider" viewBox="0 0 600 12" fill="none"><path d="M20 6 Q80 3, 150 6 T 300 5 T 450 7 T 580 5" stroke="#6b5f52" stroke-width="1.2" opacity="0.35"/></svg>

  <div class="content-wrapper">
    <!-- 侧边栏索引 -->
    <aside class="sidebar">
      <div class="sidebar-sticky">
        <div class="timeline-header">
          <button class="timeline-btn" onclick="resetFilter()">↺ 时光索引</button>
        </div>
        <ul class="timeline-list">
          {{SIDEBAR_CONTENT}}
        </ul>
      </div>
    </aside>

    <!-- 内容列表 -->
    <section class="diary-section">
      <div class="diary-header reveal">
        <h2 id="list-title">全部日志</h2>
      </div>
      <div class="diary-grid" id="diary-grid">
        {{GRID_CONTENT}}
      </div>
    </section>
  </div>

  <footer><p>天空之城 · 用温柔记录生活 · ♡ 2025</p></footer>
</main>

<script>
const observer = new IntersectionObserver((entries)=>{
  entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.1 });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

function filterByYear(year, el) {
  // Toggle logic for smoother interaction
  const parent = el.parentElement;
  const wasActive = parent.classList.contains('active');
  
  // Close all
  document.querySelectorAll('.year-item').forEach(i => i.classList.remove('active'));
  document.querySelectorAll('.month-item').forEach(i => i.classList.remove('active'));
  
  if (!wasActive) {
    parent.classList.add('active');
    document.getElementById('list-title').innerText = year + " 年";
    filterCards(year, null);
  } else {
    // If clicking active year, maybe reset? Or just keep it. Let's keep it active.
    parent.classList.add('active');
    document.getElementById('list-title').innerText = year + " 年";
    filterCards(year, null);
  }
}

function filterByMonth(year, month, el) {
  event.stopPropagation();
  document.querySelectorAll('.month-item').forEach(i => i.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('list-title').innerText = year + " 年 " + month + " 月";
  filterCards(year, month);
}

function filterCards(year, month) {
  const cards = document.querySelectorAll('.diary-card');
  cards.forEach(card => {
    const matchYear = card.dataset.year === year;
    const matchMonth = month ? card.dataset.month === month : true;
    
    if (matchYear && matchMonth) {
      card.classList.remove('hidden');
    } else {
      card.classList.add('hidden');
    }
  });
}

function resetFilter() {
  document.querySelectorAll('.year-item').forEach(i => i.classList.remove('active'));
  document.querySelectorAll('.month-item').forEach(i => i.classList.remove('active'));
  document.getElementById('list-title').innerText = "全部日志";
  document.querySelectorAll('.diary-card').forEach(c => c.classList.remove('hidden'));
}
</script>

<div id="music-player" style="position: fixed; bottom: 20px; right: 20px; z-index: 100; display: flex; align-items: center; background: rgba(255,255,255,0.8); padding: 8px 15px; border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.5);">
  <button id="play-btn" onclick="toggleMusic()" style="background:none; border:none; cursor:pointer; font-size: 20px; color: #4a7c6f; margin-right:10px;">▶</button>
  <span style="font-size: 12px; color: #555; font-family: sans-serif;">天空之城</span>
  <audio id="bgm" loop>
    <source src="天空之城.mp3" type="audio/mpeg">
  </audio>
</div>
<script>
  const audio = document.getElementById('bgm');
  const btn = document.getElementById('play-btn');
  audio.volume = 0.4;
  const p = audio.play();
  if (p !== undefined) {
    p.then(() => { btn.innerText = '⏸'; })
     .catch(() => { btn.innerText = '▶'; });
  }

  function toggleMusic() {
    if (audio.paused) {
      audio.play();
      btn.innerText = '⏸';
    } else {
      audio.pause();
      btn.innerText = '▶';
    }
  }
</script>

</body>
</html>
